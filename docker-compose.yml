version: "3.8"

services:
  aggregator:
    build:
      context: .
      dockerfile: services/aggregator/Dockerfile
    ports:
      - "4100:4100"
    environment:
      - PORT=4100
      - LOG_LEVEL=info
      - ZCASH_LIGHTWALLETD_URL=${LIGHTWALLETD_URL:-https://lightwalletd.example.net}
      - FHE_GATEWAY_URL=${FHE_GATEWAY_URL:-https://api.helium.fhenix.zone}
      - REGISTRY_ADDRESS=${REGISTRY_ADDRESS:-0x0000000000000000000000000000000000000000}
    depends_on:
      - lightwalletd
    networks:
      - zecrep-network

  lightwalletd:
    image: zcash/lightwalletd:latest
    ports:
      - "9067:9067"
    environment:
      - ZCASH_CONF_PATH=/zcash/zcash.conf
    volumes:
      - ./data/lightwalletd:/zcash
    networks:
      - zecrep-network
    # Note: In production, configure zcashd connection and TLS properly

  web:
    build:
      context: .
      dockerfile: apps/web/Dockerfile
    ports:
      - "3000:3000"
    environment:
      - NEXT_PUBLIC_AGGREGATOR_URL=http://aggregator:4100
      - NEXT_PUBLIC_REGISTRY_ADDRESS=${REGISTRY_ADDRESS:-0x0000000000000000000000000000000000000000}
    depends_on:
      - aggregator
    networks:
      - zecrep-network

networks:
  zecrep-network:
    driver: bridge

